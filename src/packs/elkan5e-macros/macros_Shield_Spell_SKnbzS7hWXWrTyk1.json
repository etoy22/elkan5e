{
    "name": "Shield Spell",
    "type": "script",
    "_id": "SKnbzS7hWXWrTyk1",
    "author": "3Yi0HjF4PKCA4vX0",
    "img": "icons/magic/defensive/shield-barrier-glowing-blue.webp",
    "scope": "global",
    "command": "if (args[0] === \"on\") {\n    // Get the spell level and calculate the spell bonus\n    let level = args[1];\n    let spellBonus = Math.min(Math.max(level, 1) + 2, 5);\n    // Get the token and actor\n    let token = canvas.tokens.get(args[2].tokenId);\n    let actor = token.actor;\n    let shieldBonus = 0;\n    let items = token.actor.items;\n    // Find the equipped shield\n    let shield = items.find(item => item.type === \"equipment\" && item.system.type.value === \"shield\" && item.system.equipped === true);\n\n    if (shield) {\n        // Calculate the shield bonus\n        shieldBonus = shield.system.armor.value;\n        if (shield.system.armor.magicalBonus) {\n            shieldBonus += shield.system.armor.magicalBonus;\n        }\n    }\n    // Calculate the total bonus\n    let bonus = spellBonus - shieldBonus;\n    // Define the effect data\n    let effectData = {\n        label: \"AC Bonus\",\n        icon: \"icons/magic/defensive/shield-barrier-glowing-blue.webp\", // You can use any icon you prefer\n        changes: [\n            {\n                key: \"system.attributes.ac.bonus\",\n                mode: CONST.ACTIVE_EFFECT_MODES.ADD,\n                value: bonus,\n                priority: 20\n            }\n        ],\n        origin: `Actor.${actor.id}`,\n        disabled: false,\n        duration: {\n            rounds: 1, // Duration of the effect in rounds\n        }\n    };\n    // Apply the effect to the actor\n    await actor.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\n    // console.log(`Applied AC Bonus effect: ${bonus}`);\n}\nif (args[0] === \"off\") {\n    // Get the token and actor\n    let token = canvas.tokens.get(args[2].tokenId);\n    let actor = token.actor;\n    // Find and delete the effect\n    let effect = actor.effects.find(e => e.label === \"AC Bonus\");\n    if (effect) {\n        await effect.delete();\n    }\n}",
    "folder": null,
    "sort": 0,
    "ownership": {
        "default": 0,
        "3Yi0HjF4PKCA4vX0": 3
    },
    "flags": {},
    "_stats": {
        "compendiumSource": null,
        "duplicateSource": null,
        "coreVersion": "12.331",
        "systemId": "dnd5e",
        "systemVersion": "4.2.2",
        "createdTime": 1738035754739,
        "modifiedTime": 1740626414003,
        "lastModifiedBy": "3Yi0HjF4PKCA4vX0"
    },
    "_key": "!macros!SKnbzS7hWXWrTyk1"
}