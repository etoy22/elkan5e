{
	"name": "Weakened",
	"type": "script",
	"_id": "1NtnoPvTQj1IEHCa",
	"author": "3Yi0HjF4PKCA4vX0",
	"img": "modules/elkan5e/icons/conditions/weakened.svg",
	"scope": "global",
	"command": "const actionType = workflow?.activity?.actionType;\nif (![\"mwak\", \"rwak\"].includes(actionType)) return {};\nconst damageItem = workflow?.damageItem;\nconst details = damageItem?.damageDetail;\nif (!details?.length) return {};\n\nlet updated = false;\nfor (const entry of details) {\n    const original = entry.value ?? 0;\n    const reduced = Math.floor(original * 0.5);\n    if (reduced !== original) {\n        entry.value = reduced;\n        if (typeof entry.damage === \"number\") entry.damage = reduced;\n        updated = true;\n    }\n}\nif (!updated) return {};\n\nlet damageTotal = 0;\nfor (const entry of details) {\n    const value = entry.value ?? 0;\n    if (typeof entry.damage === \"number\") entry.damage = value;\n    if (![\"temphp\", \"midi-none\", \"healing\"].includes(entry.type)) damageTotal += value;\n}\nif (typeof damageItem.totalDamage === \"number\") damageItem.totalDamage = damageTotal;\nif (typeof damageItem.appliedDamage === \"number\") damageItem.appliedDamage = damageTotal;\nreturn {};",
	"folder": null,
	"flags": {},
	"_key": "!macros!1NtnoPvTQj1IEHCa"
}