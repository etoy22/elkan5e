{
	"name": "Siphoned",
	"type": "script",
	"_id": "4X80aHI9r8I9aSKG",
	"author": "3Yi0HjF4PKCA4vX0",
	"img": "modules/elkan5e/icons/conditions/siphoned.svg",
	"scope": "global",
	"command": "const actionType = workflow?.activity?.actionType;\nif (![\"msak\", \"rsak\", \"heal\"].includes(actionType)) return {};\nconst damageItem = workflow?.damageItem;\nconst details = damageItem?.damageDetail;\nif (!details?.length) return {};\n\nconst updateTotals = () => {\n    let damageTotal = 0;\n    let healingTotal = 0;\n    for (const entry of details) {\n        const value = entry.value ?? 0;\n        if (typeof entry.damage === \"number\") entry.damage = value;\n        if (entry.type === \"healing\") healingTotal += value;\n        else if (![\"temphp\", \"midi-none\"].includes(entry.type)) damageTotal += value;\n    }\n    if (typeof damageItem.totalDamage === \"number\") damageItem.totalDamage = damageTotal;\n    if (typeof damageItem.appliedDamage === \"number\") damageItem.appliedDamage = damageTotal;\n    if (typeof damageItem.totalHealing === \"number\") damageItem.totalHealing = healingTotal;\n    if (typeof damageItem.appliedHealing === \"number\") damageItem.appliedHealing = healingTotal;\n};\n\nif (actionType === \"heal\") {\n    let updated = false;\n    for (const entry of details) {\n        if (entry.type !== \"healing\") continue;\n        const original = entry.value ?? 0;\n        const reduced = Math.floor(original * 0.5);\n        if (reduced !== original) {\n            entry.value = reduced;\n            if (typeof entry.damage === \"number\") entry.damage = reduced;\n            updated = true;\n        }\n    }\n    if (updated) updateTotals();\n    return {};\n}\n\nlet updated = false;\nfor (const entry of details) {\n    const original = entry.value ?? 0;\n    const reduced = Math.floor(original * 0.5);\n    if (reduced !== original) {\n        entry.value = reduced;\n        if (typeof entry.damage === \"number\") entry.damage = reduced;\n        updated = true;\n    }\n}\nif (updated) updateTotals();\nreturn {};",
	"folder": null,
	"flags": {},
	"_key": "!macros!4X80aHI9r8I9aSKG"
}