{
	"folder": "SjVk5lAwzIpqSBbH",
	"name": "Sorcerous Burst",
	"type": "spell",
	"_id": "4GeWN5GchYGshzgv",
	"img": "icons/magic/lightning/bolt-strike-embers-teal.webp",
	"system": {
		"activities": {
			"U9MJCgXJXClCkjsg": {
				"type": "attack",
				"activation": {
					"type": "action",
					"value": null,
					"override": false
				},
				"consumption": {
					"scaling": {
						"allowed": false
					},
					"spellSlot": true,
					"targets": []
				},
				"description": {
					"chatFlavor": ""
				},
				"duration": {
					"units": "inst",
					"concentration": false,
					"override": false
				},
				"effects": [],
				"range": {
					"override": false,
					"units": "self"
				},
				"target": {
					"type": "creature",
					"value": 1,
					"units": "ft",
					"width": null,
					"override": false,
					"prompt": true
				},
				"uses": {
					"spent": 0,
					"recovery": [],
					"max": ""
				},
				"attack": {
					"critical": {
						"threshold": null
					},
					"flat": false,
					"type": {
						"value": "ranged",
						"classification": ""
					},
					"ability": "",
					"bonus": ""
				},
				"damage": {
					"critical": {
						"bonus": ""
					},
					"includeBase": true,
					"parts": [
						{
							"custom": {
								"enabled": false,
								"formula": "1d8x@mod=8"
							},
							"number": 1,
							"denomination": 8,
							"bonus": "",
							"types": [
								"acid",
								"cold",
								"lightning",
								"fire",
								"poison",
								"psychic",
								"thunder"
							],
							"scaling": {
								"mode": "whole",
								"number": 1,
								"formula": ""
							}
						}
					]
				},
				"name": "",
				"_id": "U9MJCgXJXClCkjsg",
				"useConditionText": "",
				"useConditionReason": "",
				"effectConditionText": "",
				"macroData": {
					"name": "",
					"command": ""
				},
				"ignoreTraits": {
					"idi": false,
					"idr": false,
					"idv": false,
					"ida": false
				},
				"midiProperties": {
					"ignoreTraits": [],
					"triggeredActivityId": "exploding-attack",
					"triggeredActivityConditionText": "workflow.hitTargets.size > 0 && workflow?.damageRoll?.dice  .filter(d => d.faces === 8)  .flatMap(d => d.results.map(r => r.result))  .filter((v, i, a) => a.indexOf(v) !== i).length > 0",
					"triggeredActivityTargets": "targets",
					"triggeredActivityRollAs": "self",
					"forceDialog": false,
					"confirmTargets": "default",
					"autoTargetType": "any",
					"autoTargetAction": "default",
					"automationOnly": false,
					"otherActivityCompatible": true,
					"identifier": "",
					"displayActivityName": false,
					"rollMode": "default",
					"chooseEffects": false,
					"toggleEffect": false,
					"ignoreFullCover": false
				},
				"isOverTimeFlag": false,
				"overTimeProperties": {
					"saveRemoves": true,
					"preRemoveConditionText": "",
					"postRemoveConditionText": ""
				},
				"otherActivityId": "none",
				"attackMode": "",
				"ammunition": "",
				"otherActivityUuid": "",
				"img": "",
				"appliedEffects": []
			},
			"gz1mc22uRprTfUaM": {
				"type": "damage",
				"name": "Exploding Attack",
				"_id": "gz1mc22uRprTfUaM",
				"activation": {
					"type": "action",
					"override": false
				},
				"consumption": {
					"scaling": {
						"allowed": false
					},
					"spellSlot": true,
					"targets": []
				},
				"description": {
					"chatFlavor": ""
				},
				"duration": {
					"units": "inst",
					"concentration": false,
					"override": false
				},
				"effects": [],
				"range": {
					"units": "self",
					"override": false
				},
				"target": {
					"template": {
						"contiguous": false,
						"units": "ft"
					},
					"affects": {
						"choice": false
					},
					"override": false,
					"prompt": true
				},
				"uses": {
					"spent": 0,
					"recovery": [],
					"max": ""
				},
				"damage": {
					"critical": {
						"allow": false
					},
					"parts": [
						{
							"custom": {
								"enabled": false,
								"formula": ""
							},
							"number": 1,
							"denomination": 8,
							"bonus": "",
							"types": [
								"acid",
								"cold",
								"lightning",
								"fire",
								"poison",
								"psychic",
								"thunder"
							],
							"scaling": {
								"mode": ""
							}
						}
					]
				},
				"useConditionText": "",
				"useConditionReason": "",
				"effectConditionText": "",
				"macroData": {
					"name": "",
					"command": ""
				},
				"ignoreTraits": {
					"idi": false,
					"idr": false,
					"idv": false,
					"ida": false,
					"idm": false
				},
				"midiProperties": {
					"ignoreTraits": [],
					"triggeredActivityId": "none",
					"triggeredActivityConditionText": "",
					"triggeredActivityTargets": "targets",
					"triggeredActivityRollAs": "self",
					"autoConsume": false,
					"forceConsumeDialog": "default",
					"forceRollDialog": "default",
					"forceDamageDialog": "default",
					"confirmTargets": "default",
					"autoTargetType": "any",
					"autoTargetAction": "default",
					"automationOnly": false,
					"otherActivityCompatible": true,
					"otherActivityAsParentType": true,
					"identifier": "",
					"displayActivityName": false,
					"rollMode": "default",
					"chooseEffects": false,
					"toggleEffect": false,
					"ignoreFullCover": false,
					"removeChatButtons": "default",
					"magicEffect": false,
					"magicDamage": false,
					"noConcentrationCheck": false,
					"autoCEEffects": "default"
				},
				"isOverTimeFlag": false,
				"overTimeProperties": {
					"saveRemoves": true,
					"preRemoveConditionText": "",
					"postRemoveConditionText": ""
				},
				"img": "",
				"appliedEffects": []
			}
		},
		"uses": {
			"spent": 0,
			"recovery": [],
			"max": ""
		},
		"description": {
			"value": "<p><em>You unleash the sorcerous energy within you, which manifests in the way you choose.</em></p><p><strong>Ranged Spell Attack</strong></p><ul><li><p><strong>Hit:</strong> [[/damage]] damage.*</p></li><li><p>If you roll an 8 on a [[/r 1d8]] for this spell, you can roll another d8, and add it to the damage. The maximum number of these d8s you can add to the spell's damage equals your spellcasting ability modifier.</p></li></ul><p><strong>*At Higher Levels:</strong> This spell's damage increases by [[/damage 1d8 type=acid/cold/lightning/fire/poison/psychic/thunder]]{1d8} when you reach a total character or creature level of 5th level ([[/damage 2d8 type=acid/cold/lightning/fire/poison/psychic/thunder]]{2d8}), 11th level ([[/damage 3d8 type=acid/cold/lightning/fire/poison/psychic/thunder]]{3d8}), and 17th level ([[/damage 4d8 type=acid/cold/lightning/fire/poison/psychic/thunder]]{4d8}).</p>",
			"chat": ""
		},
		"identifier": "sorcerous-burst",
		"source": {
			"revision": 1,
			"rules": "2024",
			"book": "",
			"page": "",
			"custom": "elkan5e.com/spells/sorcerous-burst",
			"license": ""
		},
		"activation": {
			"type": "action",
			"value": null,
			"condition": ""
		},
		"duration": {
			"units": "inst"
		},
		"level": 0,
		"materials": {
			"value": "",
			"consumed": false,
			"cost": 0,
			"supply": 0
		},
		"preparation": {
			"mode": "always",
			"prepared": false
		},
		"properties": [
			"vocal"
		],
		"range": {
			"units": "ft",
			"special": "",
			"value": "120"
		},
		"school": "evo",
		"target": {
			"template": {
				"contiguous": false,
				"units": "ft",
				"type": ""
			},
			"affects": {
				"choice": false,
				"type": "creatureOrObject",
				"count": "1",
				"special": ""
			}
		}
	},
	"effects": [],
	"flags": {
		"midi-qol": {
			"rollAttackPerTarget": "default",
			"removeAttackDamageButtons": "default",
			"itemCondition": "",
			"reactionCondition": "",
			"otherCondition": "",
			"effectCondition": "",
			"fumbleThreshold": null,
			"onUseMacroName": "[postActiveEffects]ItemMacro"
		},
		"dae": {
			"macro": {
				"name": "Sorcerous Burst",
				"img": "icons/magic/lightning/bolt-strike-embers-teal.webp",
				"type": "script",
				"scope": "global",
				"command": "// Sorcerous Burst - Recursive exploding d8s (applies to hit targets)\n// Foundry VTT v13 + DND5e v5.x + Midi-QOL\n\nif (args[0].item.name !== \"Sorcerous Burst\") return {};\n\nconst workflow = args[0].workflow;\nconst actor = workflow.actor;\nconst ability = actor.system.attributes.spellcasting;\nconst abilityMod = actor.system.abilities[ability]?.mod ?? 0;\n\nconst dmgRoll = args[0].damageRoll;\nif (!dmgRoll) return {};\n\nlet dmgType = \"acid\";\ntry {\n if (workflow.damageDetail?.length) {\n  dmgType = workflow.damageDetail[0].type ?? \"acid\";\n }\n} catch (err) {\n console.warn(\"Could not determine damage type, using acid\");\n}\n\n// Count how many 8s appeared in the original roll\nlet bursts = 0;\nfor (const die of dmgRoll.dice) {\n if (die.faces === 8) {\n  bursts += die.results.filter(r => r.result === 8).length;\n }\n}\n\n// Nothing happens if no 8s\nif (bursts === 0) return {};\n\n// Cap by spellcasting mod, minimum 1\nconst totalAllowed = Math.max(abilityMod, 1);\nlet totalRolled = 0;\nlet totalDamage = 0;\n\n// Recursive explosion loop\nwhile (bursts > 0 && totalRolled < totalAllowed) {\n const toRoll = Math.min(bursts, totalAllowed - totalRolled);\n const burstRoll = await (new Roll(`${toRoll}d8[${dmgType}]`)).roll({async: true});\n await burstRoll.toMessage({flavor: `Sorcerous Burst - Exploding d8s (${toRoll})`});\n\n totalDamage += burstRoll.total;\n totalRolled += toRoll;\n\n // Count new 8s for further bursts\n bursts = 0;\n for (const die of burstRoll.dice) {\n  if (die.faces === 8) {\n   bursts += die.results.filter(r => r.result === 8).length;\n  }\n }\n}\n\nif (totalDamage > 0) {\n await new MidiQOL.DamageOnlyWorkflow(\n  actor,\n  workflow.token,\n  totalDamage,\n  dmgType,\n  workflow.hitTargets,\n  workflow.item,\n  {\n   flavor: `Sorcerous Burst - Extra Exploding Damage`,\n   itemCardId: workflow.itemCardId,\n   useOther: false\n  }\n );\n}\n\nreturn {};",
				"author": "3Yi0HjF4PKCA4vX0",
				"_id": null,
				"folder": null
			}
		}
	},
	"_key": "!items!4GeWN5GchYGshzgv"
}